<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Optimization and vectorization compilation options &#8212; Smilei 5.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/smilei_theme.css?v=3908db80" />
    <script src="../_static/documentation_options.js?v=4af8989d"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../_static/smileiIcon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Syntax changes" href="../syntax_changes.html" />
    <link rel="prev" title="Generation of the external tables" href="tables.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": {
      scale: 95,
      availableFonts: ["TeX"]
    }
  });
  </script>
   
  </head><body>

<div id="smallScreenMenu" class="off">

    
    <div class="toctree-smilei">
        <ul>
            <li class="outer">
                <a href="../Overview/synopsis.html">Synopsis</a>
            </li>
            <li class="outer">
                <a href="../Overview/highlights.html">Highlights</a>
            </li>
            <li class="outer">
                <a href="../Overview/releases.html">Releases</a>
            </li>
            <li class="outer">
                <a href="../Overview/licence.html">Licence</a>
            </li>
            <li class="outer">
                <a href="../Overview/material.html">Publications</a>
            </li>
            <li class="outer">
                <a href="../Overview/partners.html">Partners</a>
            </li>
        </ul>
        <hr />
        <ul>
            <li class="outer">
                <a href="../Understand/units.html">Units</a>
            </li>
            <li class="outer">
                <a href="../Understand/algorithms.html">PIC algorithms</a>
            </li>
            <li class="outer">
                <a href="../Understand/performances.html">Parallelization & optimization</a>
            </li>
            <li class="outer">
                <a href="../Understand/physics_modules.html">Physics modules</a>
            </li>
            <li class="outer">
                <a href="../Understand/numerical_techniques.html">Advanced numerical techniques</a>
            </li>
            <li class="outer">
                <a href="../Understand/PML.html">Perfectly Matched Layers</a>
            </li>
        </ul>
        <hr />
        <ul>
            <li class="outer">
                <a href="installation.html">Install</a>
            </li>
            <li class="outer">
                <a href="https://smileipic.github.io/tutorials">Smilei tutorials</a>
            </li>
            <li class="outer">
                <a href="namelist.html">Write a namelist</a>
            </li>
            <li class="outer">
                <a href="run.html">Run</a>
            </li>
            <li class="outer">
                <a href="post-processing.html">Post-process</a>
            </li>
            <li class="outer">
                <a href="contribute.html">Contribute</a>
            </li>
            <li class="outer">
                <a href="troubleshoot.html">Troubleshoot</a>
            </li>
            <li class="outer">
                <a href="GPU_version.html">GPU version</a>
            </li>
        </ul>
        <hr />
    </div>

</div>
<div id="hcontainer">
    <div id="nav_positioner">
        <div id="nav">
            <div id="nav_button" onclick="toggleNav()">
                Sections
            </div>
            <div id="nav_list" class="toctree-smilei">
                <div id="nav_title"><a href="#">Optimization and vectorization compilation options</a></div>
                <ul>
<li><a class="reference internal" href="#">Optimization and vectorization compilation options</a></li>
</ul>

            </div>
        </div>
    </div>
    
    <div class="headercolor">
    </div>
    <div class="hpositioner">
        <div class="header">
        <div class="logo">
            <a href="../index.html">
                <img class="logo" src="../_static/smileiLogo.svg" alt="Logo" />
            </a>
            <!--
            <div style="height:7mm; position: absolute; top:2mm; left:-32mm; padding: 1mm 2mm 0 2mm; border-radius: 2mm; background-color:#C5DCEA; background-color:var(--header_text);">
                <a href="https://indico.math.cnrs.fr/e/smilei5">
                    <img src="../_static/workshopLogo.svg" alt="workshop"
                        style="height:5mm;padding-top: 1mm;" />
                </a>
            </div>
            -->
        </div>
        <div class="menu"
            id="menu_Overview"
            
        >
            <div id="menuButton_Overview" class="menuButton"
                 onmouseenter="prepareMenu('menu_Overview')"
                 onmousedown="event.preventDefault()"
            >
                <a href="../overview.html">
                    <span>Overview</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_Overview',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="../Overview/synopsis.html">Synopsis</a>
                        </li>
                        <li class="outer">
                            <a href="../Overview/highlights.html">Highlights</a>
                        </li>
                        <li class="outer">
                            <a href="../Overview/releases.html">Releases</a>
                        </li>
                        <li class="outer">
                            <a href="../Overview/licence.html">Licence</a>
                        </li>
                        <li class="outer">
                            <a href="../Overview/material.html">Publications</a>
                        </li>
                        <li class="outer">
                            <a href="../Overview/partners.html">Partners</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        <div class="menu"
            id="menu_Understand"
            
        >
            <div id="menuButton_Understand" class="menuButton"
                 onmouseenter="prepareMenu('menu_Understand')"
                 onmousedown="event.preventDefault()"
            >
                <a href="../understand.html">
                    <span>Understand</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_Understand',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="../Understand/units.html">Units</a>
                        </li>
                        <li class="outer">
                            <a href="../Understand/algorithms.html">PIC algorithms</a>
                        </li>
                        <li class="outer">
                            <a href="../Understand/performances.html">Parallelization & optimization</a>
                        </li>
                        <li class="outer">
                            <a href="../Understand/physics_modules.html">Physics modules</a>
                        </li>
                        <li class="outer">
                            <a href="../Understand/numerical_techniques.html">Advanced numerical techniques</a>
                        </li>
                        <li class="outer">
                            <a href="../Understand/PML.html">Perfectly Matched Layers</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        <div class="last menu"
            id="menu_Use"
            
        >
            <div id="menuButton_Use" class="menuButton"
                 onmouseenter="prepareMenu('menu_Use')"
                 onmousedown="event.preventDefault()"
            >
                <a href="../use.html">
                    <span>Use</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_Use',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="installation.html">Install</a>
                        </li>
                        <li class="outer">
                            <a href="https://smileipic.github.io/tutorials">Smilei tutorials</a>
                        </li>
                        <li class="outer">
                            <a href="namelist.html">Write a namelist</a>
                        </li>
                        <li class="outer">
                            <a href="run.html">Run</a>
                        </li>
                        <li class="outer">
                            <a href="post-processing.html">Post-process</a>
                        </li>
                        <li class="outer">
                            <a href="contribute.html">Contribute</a>
                        </li>
                        <li class="outer">
                            <a href="troubleshoot.html">Troubleshoot</a>
                        </li>
                        <li class="outer">
                            <a href="GPU_version.html">GPU version</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        
        <script type="text/javascript">
            var es=document.getElementsByClassName("menuButton"), i=0;
            var evt = "ontouchend" in document ? "touchend" : "click";
            for( var i=0; i<es.length; i+=1 ) {
                es[i].addEventListener(evt, function(a){ return function(){toggleMenu(a)};}(es[i].parentNode.id));
            }
        </script>
        
        <div id="searchbox" role="search" style="display:none">
            <form class="search" action="../search.html" method="get">
              <input type="text" name="q" placeholder="Search" id="searchinput" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
        
        <div id="searchicon" onclick="openSearch()" style="display:block">
            <svg
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 80 120">
              <g transform="translate(0,-932.36216)" >
                <circle
                   r="25" cy="977.51044" cx="38.078663"
                   style="opacity:1;fill:none;stroke:#ffffff;stroke:var(--header_text);stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <rect
                   transform="matrix(0.36717877,0.93015039,-0.93427297,0.35655858,0,0)"
                   rx="4.9996676" ry="7.4995141" x="947.6142" y="316.16959"
                   height="14.117695" width="46.476151"
                   style="opacity:1;fill:#ffffff;fill:var(--header_text);fill-opacity:1;stroke:none;" />
                <path
                   d="m 41.383282,962.25996 a 15,15 0 0 1 11.660107,11.6355"
                   style="opacity:1;fill:none;stroke:#ffffff;stroke:var(--header_text);stroke-width:3;stroke-linecap:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
              </g>
            </svg>
        </div>
        <div id="closesearchicon" onclick="closeSearch()" style="display:none">
            <svg
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 80 120">
              <g
                 transform="translate(0,-932.36216)"
                 style="fill:none;stroke:#ffffff;stroke:var(--header_text);stroke-width:10;stroke-linecap:round;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none">
                <path d="m 10,962.36216 60,60.00004" />
                <path d="M 70,962.36216 10,1022.3622" />
              </g>
            </svg>
        </div>
        
        <div id="smallScreenMenuButton" onclick="event.preventDefault(); toggleSmallScreenMenu(event)">
            <svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"
               viewBox="-20 -20 140 140">
              <g  style="fill:#ffffff; fill:var(--header_text);stroke:none;">
                <circle cx="15" cy="20" r="5" />
                <circle cx="35" cy="20" r="5" />
                <circle cx="85" cy="20" r="5" />
                <rect width="50" height="10" x="35" y="15" rx="0" ry="0" />
                <circle cx="15" cy="40" r="5" />
                <circle cx="35" cy="40" r="5" />
                <circle cx="85" cy="40" r="5" />
                <rect width="50" height="10" x="35" y="35" rx="0" ry="0" />
                <circle cx="15" cy="60" r="5" />
                <circle cx="35" cy="60" r="5" />
                <circle cx="85" cy="60" r="5" />
                <rect width="50" height="10" x="35" y="55" rx="0" ry="0" />
                <circle cx="15" cy="80" r="5" />
                <circle cx="35" cy="80" r="5" />
                <circle cx="85" cy="80" r="5" />
                <rect width="50" height="10" x="35" y="75" rx="0" ry="0" />
              </g>
            </svg>
        </div>
        
    </div>
    
</div>
</div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="optimization-and-vectorization-compilation-options">
<h1>Optimization and vectorization compilation options<a class="headerlink" href="#optimization-and-vectorization-compilation-options" title="Link to this heading">¶</a></h1>
<p>Modern and mature compilers can automatically and deeply optimize the code for specific hardware.
Optimization features can be activated and tuned using compiler flags.
Among possible optimization capabilities, we can mention loop refactoring (unrolling, reordoring, splitting, etc), inlining, vectorization, pipelining and more.
Each compiler has its own flags.
While some share a common syntax, others provide more fine tuning options for specific processors (like Fujitsu for the A64FX).</p>
<p>Some optimization flags are automatically set in the makefile;
others are specified in the <em>machine files</em> because they are specific to given compilers, hardwares or processor families.
<a class="reference internal" href="../Understand/vectorization.html"><span class="doc">SIMD vectorization</span></a> in Smilei, for instance,
can be automatic, or can rely on OpenMP’s directive <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">omp</span> <span class="pre">simd</span></code>.</p>
<p>Options are passed to the compiler through the environment variable <code class="docutils literal notranslate"><span class="pre">CXXFLAGS</span></code>.
Most machine files include appropriate flags to ensure the best performance
on a given processor type using a given compiler (most often Intel but also GNU, LLVM, ARMCLANG and Fujitsu).</p>
<p>For instance, <strong class="program">Smilei</strong> has been tested on
Intel processors (Skylake 8168) with an Intel environment.
The following flags, located in the <code class="docutils literal notranslate"><span class="pre">skylake</span></code> machine file, provide a good performance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-xCOMMON-AVX512<span class="w"> </span>-ip<span class="w"> </span>-ipo<span class="w"> </span>-inline-factor<span class="o">=</span><span class="m">1000</span><span class="w"> </span>-D__INTEL_SKYLAKE_8168<span class="w"> </span>-fno-alias
</pre></div>
</div>
<p>The vectorization must also be activated <a class="reference internal" href="namelist.html#vectorization"><span class="std std-ref">in the namelist</span></a>.</p>
<p>The following explains the meaning of the flags commonly used in our machine files.
You can use this section to design your own machine file.</p>
<p class="rubric">Intel compiler flags for optimization and vectorization</p>
<p>The following options are commonly used by Smilei’s machine files to compile on most modern x86 processors (both Intel and AMD). They enure the best performance of the code, especially for vectorization.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-O3</span></code>: this option directly integrated in the makefile tells the compiler to use agressive optimization at compilation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-march=cpu-type</span></code>: Tells the compiler to generate code for processors that support certain features. See <a class="reference external" href="https://www.intel.com/content/www/us/en/develop/documentation/cpp-compiler-developer-guide-and-reference/top/compiler-reference/compiler-options/compiler-option-details/code-generation-options/march.html">this page</a> for more info.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-xCPU-TYPE</span></code>: Tells the compiler which processor features it may target, including which instruction sets and optimizations it may generate. <code class="docutils literal notranslate"><span class="pre">CPU-TYPE</span></code> can be the instruction set or the processor family name. This option is important for vectorization. See <a class="reference external" href="https://www.intel.com/content/www/us/en/develop/documentation/cpp-compiler-developer-guide-and-reference/top/compiler-reference/compiler-options/compiler-option-details/code-generation-options/x-qx.html#x-qx">this page</a> for more info.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-xCOMMON-AVX512</span></code>: for processors that support AVX512 (Skylake, Cascadelake)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-xMIC-AVX512</span></code>: suitable for first-generation AVX512 processors (KNL family)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-xCORE-AVX2</span></code>: for processors using the AVX2 instruction set such as Intel Broadwell (3nd generation E3, E5 and E7 Xeon family) and AMD Epyc processors</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-xAVX</span></code>: for the first generation E3 and E5 Xeon family</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-xSKYLAKE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-xKNL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-xBROADWELL</span></code></p></li>
<li><p>and more…</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ip</span></code>: interprocedural optimizations for single-file compilation. This flag is important for function inline in a single C++ file. This option is not by default in the makefile but is available in many machine files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ipo</span></code>: Interprocedural optimization, a step that examines function calls between files when the program is linked.  This flag must be used to compile and when linking. Compile times are very long with this flag, however depending on the application there may be appreciable performance improvements when combined with the -O* flags. This flag is not by default in the makefile and is rarely used due to long compilation time. Use this flag for production runs if you do not plan to often recompile.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-inline-factor=1000</span></code>: Specifies the percentage multiplier that should be applied to all inlining options that define upper limits.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-fno-alias</span></code>: this is recommended only as an experiment, possibly to see whether a useful restrict keyword has been missed. It would mean that the compiler could ignore unproven aliasing hazards.</p></li>
</ul>
<p>A detailed description of the available flags for x86 instruction sets is given on this <a class="reference external" href="https://www.intel.com/content/www/us/en/developer/articles/technical/performance-tools-compiler-options-for-sse-generation-and-processor-specific-optimizations.html/">page</a>.
All Intel compiler flags are listed on this  <a class="reference external" href="https://www.intel.com/content/www/us/en/develop/documentation/cpp-compiler-developer-guide-and-reference/top/compiler-reference/compiler-options/alphabetical-list-of-compiler-options.html/">page</a>.</p>
<p>More examples:</p>
<ul class="simple">
<li><p>For AMD EPYC ROME processors:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-march<span class="o">=</span>core-avx2<span class="w"> </span>-xCORE-AVX2<span class="w"> </span>-ip<span class="w"> </span>-inline-factor<span class="o">=</span><span class="m">1000</span><span class="w"> </span>-fno-alias<span class="w"> </span><span class="c1">#-ipo</span>
</pre></div>
</div>
<ul class="simple">
<li><p>For Intel Broadwell processors:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-xCORE-AVX2<span class="w"> </span>-O3<span class="w"> </span>-ip<span class="w"> </span>-inline-factor<span class="o">=</span><span class="m">1000</span><span class="w"> </span>-D__INTEL_BDW_E5_2697_V4<span class="w"> </span>-fno-alias
</pre></div>
</div>
<ul class="simple">
<li><p>For Intel Cascadelake processors:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-march<span class="o">=</span>cascadelake<span class="w"> </span>-xCOMMON-AVX512<span class="w"> </span>-ip<span class="w"> </span>-inline-factor<span class="o">=</span><span class="m">1000</span><span class="w"> </span>-D__INTEL_CASCADELAKE_6248<span class="w"> </span>-qopt-zmm-usage<span class="o">=</span>high<span class="w"> </span>-fno-alias<span class="w"> </span><span class="c1">#-ipo</span>
</pre></div>
</div>
<ul class="simple">
<li><p>For Intel KNL processors:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-march<span class="o">=</span>knl<span class="w"> </span>-xMIC-AVX512<span class="w"> </span>-ip<span class="w"> </span>-inline-factor<span class="o">=</span><span class="m">1000</span><span class="w"> </span>-D__INTEL_KNL_7250<span class="w"> </span>-qopt-zmm-usage<span class="o">=</span>high<span class="w"> </span>-fno-alias<span class="w"> </span><span class="c1">#-ipo</span>
</pre></div>
</div>
<p class="rubric">GNU compiler flags for optimization and vectorization</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-O3</span></code>: this option directly integrated in the makefile tells the compiler to use agressive optimization at compilation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Ofast</span></code>: Disregard strict standards compliance. -Ofast enables all -O3 optimizations. It also enables optimizations that are not valid for all standard-compliant programs.It can result in incorrect output for programs that depend on an exact implementation of IEEE or ISO rules/specifications for math functions. It may, however, yield faster code for programs that do not require the guarantees of these specifications.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-mtune=cpu-type</span></code>: This option specifies that GCC should tune the performance of the code as if the target were of the type specified in this option, here <code class="docutils literal notranslate"><span class="pre">cpu-type</span></code>.For some ARM implementations better performance can be obtained by using this option. Possible common cpu types are</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cascadelake</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skylake-avx512</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a64fx</span></code> for A64FX Fujitsu processor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">knl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">broadwell</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">znver2</span></code> for 2nd generation AMD EPYC processors</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">znver2</span></code> for 3rd generation AMD EPYC processors</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-march=cpu-type</span></code>: This flag does additional tuning for specific processor types. Specifying -march=cpu-type implies -mtune=cpu-type, except where noted otherwise.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cascadelake</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skylake-avx512</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sve</span></code> to generate SVE instructions (vectorization on ARM like A64FX)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">armv8.2-a</span></code> to generate armv8 instructions (like A64FX)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">knl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">broadwell</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">znver2</span></code> for 2nd generation AMD EPYC processors</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">znver3</span></code> for 3rd generation AMD EPYC processors</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-msve-vector-bits=512</span></code>: Specify the number of bits in an SVE vector register on ARM architecture using SVE (useful for A64FX).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ffast-math</span></code>: This option is not turned on by any -O option besides -Ofast since it can result in incorrect output for programs that depend on an exact implementation of IEEE or ISO rules/specifications for math functions. It may, however, yield faster code for programs that do not require the guarantees of these specifications.</p></li>
</ul>
<p>Find out more information:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html">Optimization flags for GNU</a>.</p></li>
<li><p><a class="reference external" href="https://linux.die.net/man/1/g++">g++ man page</a>.</p></li>
<li><p><a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Submodel-Options.html#Submodel-Options/">list of architecture options</a>.</p></li>
<li><p><a class="reference external" href="https://developer.amd.com/wordpress/media/2020/04/Compiler%20Options%20Quick%20Ref%20Guide%20for%20AMD%20EPYC%207xx2%20Series%20Processors.pdf">AMD quick reference guide</a>.</p></li>
</ul>
<p class="rubric">LLVM compiler flags for optimization and vectorization</p>
<p>The LLVM compiler shares many flags with the GNU one.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-O3</span></code>: this option directly integrated in the makefile tells the compiler to use agressive optimization at compilation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Ofast</span></code>: Disregard strict standards compliance. -Ofast enables all -O3 optimizations. It also enables optimizations that are not valid for all standard-compliant programs.It can result in incorrect output for programs that depend on an exact implementation of IEEE or ISO rules/specifications for math functions. It may, however, yield faster code for programs that do not require the guarantees of these specifications.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-mtune=cpu-type</span></code>: This option specifies that LLVM should tune the performance of the code as if the target were of the type specified in this option, here <code class="docutils literal notranslate"><span class="pre">cpu-type</span></code>.For some ARM implementations better performance can be obtained by using this option. Possible common cpu types are</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cascadelake</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skylake-avx512</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a64fx</span></code> for A64FX Fujitsu processor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">knl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">broadwell</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">znver2</span></code> for 2nd generation AMD EPYC processors</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">znver2</span></code> for 3rd generation AMD EPYC processors</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-march=cpu-type</span></code>: This flag does additional tuning for specific processor types. Specifying <code class="docutils literal notranslate"><span class="pre">-march=cpu-type</span></code> implies <code class="docutils literal notranslate"><span class="pre">-mtune=cpu-type</span></code>, except where noted otherwise.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cascadelake</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skylake-avx512</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sve</span></code> to generate SVE instructions (vectorization on ARM like A64FX)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">armv8.2-a</span></code> to generate armv8 instructions (like A64FX)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">knl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">broadwell</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">znver2</span></code> for 2nd generation AMD EPYC processors</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">znver3</span></code> for 3rd generation AMD EPYC processors</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ffast-math</span></code>: Enable fast-math mode. This option lets the compiler make aggressive, potentially-lossy assumptions about floating-point math.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ffinite-math-only</span></code>: Allow floating-point optimizations that assume arguments and results are not NaNs or +-Inf.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ffp-contract=off|on|fast|fast-honor-pragmas</span></code>: Specify when the compiler is permitted to form fused floating-point operations, such as fused multiply-add (FMA). Fused operations are permitted to produce more precise results than performing the same operations separately.</p></li>
</ul>
<p>Some examples:</p>
<ul class="simple">
<li><p>For Intel Cascade processors:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-mtune<span class="o">=</span>cascadelake<span class="w"> </span>-march<span class="o">=</span>cascadelake<span class="w"> </span>-ffinite-math-only<span class="w"> </span>-ffp-contract<span class="o">=</span>fast
</pre></div>
</div>
<ul class="simple">
<li><p>For the A64FX processor:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-march<span class="o">=</span>armv8.2-a+sve<span class="w"> </span>-ffinite-math-only<span class="w"> </span>-fsimdmath<span class="w"> </span>-fopenmp-simd<span class="w"> </span>-ffp-contract<span class="o">=</span>fast<span class="w"> </span><span class="c1">#-ffast-math</span>
</pre></div>
</div>
<p>Find out more information:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://clang.llvm.org/docs/UsersManual.html">LLVM Clang user manual</a>.</p></li>
</ul>
<p class="rubric">Fujitsu compiler flags for optimization and vectorization</p>
<p>Fujitsu compiler is only used or the A64FX processor so far.
The compiler can work in two differents modes called Trad and Clang mode.
The Clang mode uses the Clang compilation flags.
The Trad moe is usually the default one, the Clang mode an be activated using the flag <code class="docutils literal notranslate"><span class="pre">-Nclang</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-O3</span></code> (bothy in Trad and clang mode): by default in the makefile</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Kfast</span></code> (in Trad mode) / <code class="docutils literal notranslate"><span class="pre">-Ofast</span></code> (in Clang mode)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-KA64FX</span></code> (in Trad mode)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-KSVE</span></code> (in Trad mode) / <code class="docutils literal notranslate"><span class="pre">-march=sve</span></code> (in Clang mode)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-KSSL2</span></code> (in Trad mode)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Kparallel</span></code> (in Trad mode)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Kunroll</span></code> (in Trad mode)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Ksimd=2</span></code> (in Trad mode)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Kassume=notime_saving_compilation</span></code> (in Trad mode)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Kocl</span></code> (in Trad mode) / <code class="docutils literal notranslate"><span class="pre">-ffj-ocl</span></code> (in Clang mode)</p></li>
</ul>
<p class="rubric">Smilei compiler flags for adaptive vectorization</p>
<p>Performance models are implemented in <strong class="program">Smilei</strong> for adaptive vectorization.
By default, a general performance model is used but some performance models can be used for specific types of processors:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-D__INTEL_CASCADELAKE_6248</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-D__INTEL_SKYLAKE_8168</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-D__AMD_ROME_7H12</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-D__INTEL_KNL_7250</span></code>: available in 3D only</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-D__INTEL_BDW_E5_2697_V4</span></code>: available in 3D only</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-D__INTEL_HSW_E5_2680_v3</span></code>: available in 3D only</p></li>
</ul>
<p>These flags are used in the corresponding machine files.</p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      <div>
        <input type="button" id="themebutton"  value="" onclick="switchTheme('')" />
      </div>
      <div>
      <a href="site.html">Site index</a>
      </div>
      <div>
        Last updated on May 26, 2025
      </div>
      
      <div>
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      </div>
      
    </div>
    
    <script type="text/javascript">
        
        var nav = document.getElementById("nav");
        var nav_list = document.getElementById("nav_list");
        var nav_button = document.getElementById("nav_button");
        var smallScreenMenu = document.getElementById("smallScreenMenu");
        var smallScreenMenuButton = document.getElementById("smallScreenMenuButton");
        var searchicon = document.getElementById("searchicon");
        var searchbox  = document.getElementById("searchbox");
        var searchinput= document.getElementById("searchinput");
        var menus = document.getElementsByClassName("menu");
        for( var i=0; i<menus.length; i++ )
            menus[i].active = false;
        
        // Manage theme
        var theme="light";
        function switchTheme(type) {
            if( type == "dark" || ( ! type && theme == "light" ) ) {
                theme = "dark";
                document.documentElement.setAttribute('theme', 'dark');
                window.name = "dark_theme"
                localStorage.setItem("_theme","dark")
            } else {
                theme = "light";
                document.documentElement.setAttribute('theme', 'light');
                window.name = "light_theme"
                localStorage.setItem("_theme","light")
            }
        }
        if( window.name && window.name == "light_theme" ) {
            switchTheme("light");
        } else if ( window.name && window.name == "dark_theme" ) {
            switchTheme("dark");
        } else if( stored_theme = localStorage.getItem("_theme") ) {
            switchTheme(stored_theme);
        } else if( window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
            switchTheme("dark");
        }
        
        var ul = nav_list.getElementsByTagName("ul")[0], li;
        var keep_nav = false;
        if( ul ) {
            li = ul.firstElementChild;
            if( li ) {
                if( li.getElementsByTagName("ul").length > 0 ) keep_nav = true;
            }
        }
        if( keep_nav ) {
            li.removeChild( li.firstElementChild );
        } else {
            document.getElementById("nav_positioner").removeChild( document.getElementById("nav") );
        }
        
        function navOff() {
            nav_list.style.display = "none";
            nav_button.className = "";
            nav.style.overflowY = "visible";
        }
        
        function toggleNav() {
            for( var i=0; i<menus.length; i++ )
                menuOff( menus[i] );
            if( nav_list.style.display != "inline-block" ) {
                nav_list.style.display = "inline-block";
                nav_button.className = "pushed";
                nav.style.overflowY = "auto";
            } else {
                navOff();
            }
        }
        
        function toggleSmallScreenMenu(e) {
            if( smallScreenMenu.className != "on" ) {
                smallScreenMenu.className = "on";
                smallScreenMenuButton.className = "pushed";
                document.documentElement.style.overflow = "hidden";
            } else {
                smallScreenMenu.className = "off";
                smallScreenMenuButton.className = "";
                document.documentElement.style.overflow = "";
            }
        }
        
        if (smallScreenMenuAfterTOC = document.getElementById("smallScreenMenuAfterTOC")) {
            var smallScreenMenuTOC = smallScreenMenuAfterTOC.previousElementSibling
                .getElementsByTagName("li")[0].getElementsByTagName("ul")[0].getElementsByTagName("li");
            for (var i = 0; i < smallScreenMenuTOC.length; i++) {
                if (smallScreenMenuTOC[i].tagName = "a") {
                    smallScreenMenuTOC[i].addEventListener("click", function(event){ toggleSmallScreenMenu(event); } );
                }
            }
        }
        
        function prepareMenu(menu_id) {
            var menu = document.getElementById(menu_id);
            menu.timer1 = setTimeout(function(a){ return function(){thisMenuOnly(a)};}(menu_id), 100);
            menu.addEventListener("mouseleave", function(a){ return function(){clearTimeout(a.timer1)};}(menu) );
        }
        
        function leaveMenu(menu_id, source) {
            var menu = document.getElementById(menu_id);
            menu.timer2 = setTimeout(function(a){ return function(){menuOff(a)};}(menu), 1000);
            source.addEventListener("mouseenter", function(a){ return function(){clearTimeout(a.timer2)};}(menu) );
        }
        
        function menuOn( menu ) {
            var divs = menu.getElementsByTagName("div");
            if(nav_list) navOff();
            divs[1].className = "on";
            divs[0].className = "menuButton pushed";
            menu.active = true;
        }
        function menuOff( menu ) {
            var divs = menu.getElementsByTagName("div");
            divs[1].className = "off";
            divs[0].className = "menuButton";
            menu.active = false;
        }
        
        function thisMenuOnly(menu_id) {
            var menu = document.getElementById(menu_id);
            for( var i=0; i<menus.length; i++ )
                if( i!=menu_id )
                    menuOff( menus[i] );
            menuOn( menu );
        }
        
        function toggleMenu(menu_id) {
            var menu = document.getElementById(menu_id);
            if( menu.active ) {
                menuOff( menu );
            } else {
                for( var i=0; i<menus.length; i++ )
                    if( i!=menu_id )
                        menuOff( menus[i] );
                menuOn( menu );
            }
        }
        
        function openSearch() {
            for( var i=0; i<menus.length; i++ ) {
                menuOff( menus[i] );
                menus[i].style.zIndex = "-1";
            }
            searchicon.style.display = "none";
            closesearchicon.style.display = "block";
            searchbox.style.display = "block";
            searchinput.focus();
        }
        
        function closeSearch() {
            searchicon.style.display = "block";
            closesearchicon.style.display = "none";
            searchbox .style.display = "none";
            for( var i=0; i<menus.length; i++ )
                menus[i].style.zIndex = "0";
        }
        
        
        var documentDiv = document.getElementsByClassName("document")[0];
        documentDiv.addEventListener('click', function (event) {
            if(nav_list) navOff();
            for( var i=0; i<menus.length; i++ )
                menuOff( menus[i] );
        });
    </script>
  </body>
</html>